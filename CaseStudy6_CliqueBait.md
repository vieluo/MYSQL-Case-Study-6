# 8 Weeks SQL Challenge - 6th Week

### This [case study](https://8weeksqlchallenge.com/case-study-6/)  is provided by Danny Ma

## Introduction
Clique Bait is not like your regular online seafood store - the founder and CEO Danny, was also a part of a digital data analytics team and wanted to expand his knowledge into the seafood industry!

In this case study - you are required to support Dannyâ€™s vision and analyse his dataset and come up with creative solutions to calculate funnel fallout rates for the Clique Bait online store.

The database can be found [HERE](https://8weeksqlchallenge.com/case-study-6/)

## Digital Analysis
1. How many users are there?

```sql
SELECT COUNT(DISTINCT user_id) AS user_number
FROM users
```

| user_number | 
|-----|
| 500 | 

2. How many cookies does each user have on average?

```sql
SELECT COUNT(cookie_id)/COUNT(DISTINCT user_id) AS avg_cookie
FROM user
```

| avg_cookie | 
|--------|
| 3.5640 | 

3. What is the unique number of visits by all users per month?

Since the visit_id is related to cookie_id, first I check wether the cookie_id are unique for each user, there is no same cookie_id generated by two users.

```sql
SELECT cookie_id, COUNT(DISTINCT user_id) AS distinct_values
FROM users
GROUP BY cookie_id
HAVING COUNT(DISTINCT user_id) > 1;
```

There is no value returned, so the cookie_id is unique by user.

```sql
SELECT MONTH(start_date) AS month, COUNT(cookie_id) AS number_visit
FROM users
GROUP BY MONTH(start_date)
ORDER BY MONTH(start_date)
```

|month|number_visit|
|---|------|
| 1 | 438  |
| 2 | 744  |
| 3 | 458  |
| 4 | 124  |

4. What is the number of events for each event type?

```sql
SELECT event_name, COUNT(event_type) AS number_event
FROM (
SELECT events.*, event_identifier.event_name
FROM events
JOIN event_identifier ON
events.event_type = event_identifier.event_type
) consolidate
GROUP BY event_name
```

| event_name | number_event |
|---------------|--------|
| Page View     | 20928  |
| Add to Cart   | 8451   |
| Purchase      | 1777   |
| Ad Impression | 876    |
| Ad Click      | 702    |

5. What is the percentage of visits which have a purchase event?

```sql
SELECT event_name, COUNT(event_type) AS number_event, ROUND (COUNT(event_type) * 100 /sum(count(event_type)) over (), 2) AS percentage
FROM (
SELECT events.*, event_identifier.event_name
FROM events
JOIN event_identifier ON
events.event_type = event_identifier.event_type
) consolidate
GROUP BY event_name
```

| event_name     | number_event | percentage |
|---------------|-------|--------|
| Page View     | 20928 | 63.93  |
| Add to Cart   | 8451  | 25.82  |
| Purchase      | 1777  | 5.43   |
| Ad Impression | 876   | 2.68   |
| Ad Click      | 702   | 2.14   |

We can see that the purchase event occured 5.43%

6. What is the percentage of visits which view the checkout page but do not have a purchase event?

```sql
WITH cart AS (
SELECT event_name, COUNT(event_type) AS number_event_cart
FROM (
SELECT events.*, event_identifier.event_name
FROM events
JOIN event_identifier ON
events.event_type = event_identifier.event_type
) consolidate
WHERE event_name = 'Add to Cart'
GROUP BY event_name
),

purchase AS (
SELECT event_name, COUNT(event_type) AS number_event_purchase
FROM (
SELECT events.*, event_identifier.event_name
FROM events
JOIN event_identifier ON
events.event_type = event_identifier.event_type
) consolidate
WHERE event_name = 'Purchase'
GROUP BY event_name
)

SELECT ROUND (purchase.number_event_purchase / cart.number_event_cart *100 ,2) AS percentage_purchase_cart
FROM cart, purchase
```

| percentage_purchase_cart |
| -------|
| 21.03  |

7. What are the top 3 pages by number of views?

```sql
SELECT page_name, COUNT(page_id) AS number_view
FROM (
SELECT events.*, page_hierarchy.page_name
FROM events 
JOIN page_hierarchy ON 
events.page_id = page_hierarchy.page_id
) consolidate
GROUP BY page_name
ORDER BY COUNT(page_id) desc
LIMIT 3
```

|  page_name   | number_view |
|--------------|-------|
| All Products | 4752  |
| Lobster      | 2515  |
| Crab         | 2513  |

8. What is the number of views and cart adds for each product category?

```sql
WITH consolidated AS (
SELECT events.*, event_identifier.event_name, page_hierarchy.page_name
FROM events 
JOIN event_identifier ON 
events.event_type = event_identifier.event_type
JOIN page_hierarchy ON
events.page_id = page_hierarchy.page_id
),

page_view AS (
SELECT page_name, event_name, COUNT(*) AS count_page_view
FROM consolidated
WHERE NOT page_name = 'All products' AND NOT page_name = 'Hoem Page' AND event_name = 'Page View'
GROUP BY page_name, event_name
),

cart AS (
SELECT page_name, event_name, COUNT(*) AS count_cart
FROM consolidated
WHERE NOT page_name = 'All products' AND NOT page_name = 'Hoem Page' AND event_name = 'Add to Cart'
GROUP BY page_name, event_name
)

SELECT page_view.*, cart.event_name, cart.count_cart
FROM page_view
JOIN cart ON
page_view.page_name = cart.page_name
ORDER BY page_name
```

|  page_name  |  event_name  | count_action |  event_name    |   count_page_view   |
|----------------|-----------|------|-------------|------|
| Abalone        | Page View | 1525 | Add to Cart | 932  |
| Black Truffle  | Page View | 1469 | Add to Cart | 924  |
| Crab           | Page View | 1564 | Add to Cart | 949  |
| Kingfish       | Page View | 1559 | Add to Cart | 920  |
| Lobster        | Page View | 1547 | Add to Cart | 968  |
| Oyster         | Page View | 1568 | Add to Cart | 943  |
| Russian Caviar | Page View | 1563 | Add to Cart | 946  |
| Salmon         | Page View | 1559 | Add to Cart | 938  |
| Tuna           | Page View | 1515 | Add to Cart | 931  |

9. What are the top 3 products by purchases?

In order to check the products purchased we need to know:
1. The visit ended in confirmation of purchase
2. Before the confirmation of purchase, what are the item that the user put in the chart

```sql
WITH consolidate AS (
SELECT events.*, event_identifier.event_name, page_hierarchy.page_name,
ROW_NUMBER() OVER (PARTITION BY visit_id ORDER BY event_time) AS num       /*in order to check whats the last action of each visit */
FROM events 
JOIN event_identifier ON 
events.event_type = event_identifier.event_type
JOIN page_hierarchy ON
events.page_id = page_hierarchy.page_id
WHERE events.event_type = 2 or events.event_type = 3       /* select only the action of add to cart and purchase */	
),

max_order AS (
SELECT visit_id, cookie_id, MAX(num) AS max_number
FROM consolidate
GROUP BY visit_id, cookie_id 
),        /* get the last action of each visit */

confirmation AS (
SELECT consolidate.*
FROM consolidate
JOIN max_order ON
consolidate.visit_id = max_order.visit_id
AND consolidate.num = max_order.max_number
WHERE event_type = 3      /* filter out the visit which ended up only in confirmation of purchasing */
),

visit_purchase AS (
SELECT consolidate.*
FROM consolidate
JOIN confirmation ON
consolidate.visit_id = confirmation.visit_id
)
/* select only the visit that ended up in confirmatino of purchasing, but we need also the event_name of Add to Cart in order to know which item the user added to purchase */

SELECT page_name, COUNT(*) AS num_purchase
FROM visit_purchase
WHERE NOT page_name = 'Confirmation'      /* Since there are two kind of event in this table, 'confirmation' and 'Add to Cart', we need to filter only the event of cart */
GROUP BY page_name
ORDER BY COUNT(*) desc
LIMIT 3
```

|   page_name  |  num_purchase | 
|---------|------|
| Lobster | 754  | 
| Oyster  | 726  | 
| Crab    | 719  | 



## Product Funnel Analysis

Using a single SQL query - create a new output table which has the following details:

* How many times was each product viewed?
* How many times was each product added to cart?
* How many times was each product added to a cart but not purchased (abandoned)?
* How many times was each product purchased?

I combined the query of Q8 and Q9 in order to get the table using a single query. 

```sql
WITH consolidate AS (
SELECT events.*, event_identifier.event_name, page_hierarchy.page_name,
ROW_NUMBER() OVER (PARTITION BY visit_id ORDER BY event_time) AS num   
FROM events 
JOIN event_identifier ON 
events.event_type = event_identifier.event_type
JOIN page_hierarchy ON
events.page_id = page_hierarchy.page_id
WHERE events.event_type = 2 or events.event_type = 3  
),      /* query of Q9 */

consolidate_all AS (
SELECT events.*, event_identifier.event_name, page_hierarchy.page_name
FROM events 
JOIN event_identifier ON 
events.event_type = event_identifier.event_type
JOIN page_hierarchy ON
events.page_id = page_hierarchy.page_id
),      /* query of Q8 */

max_order AS (
SELECT visit_id, cookie_id, MAX(num) AS max_number
FROM consolidate
GROUP BY visit_id, cookie_id 
),      /* query of Q9 */

confirmation AS (
SELECT consolidate.*
FROM consolidate
JOIN max_order ON
consolidate.visit_id = max_order.visit_id
AND consolidate.num = max_order.max_number
WHERE event_type = 3 
),      /* query of Q9 */

visit_purchase AS (
SELECT consolidate.*
FROM consolidate
JOIN confirmation ON
consolidate.visit_id = confirmation.visit_id
),      /* query of Q9 */

purchase AS (
SELECT page_name, COUNT(*) AS num_purchase
FROM visit_purchase
WHERE NOT page_name = 'Confirmation'
GROUP BY page_name
ORDER BY COUNT(*) desc
),       /* query of Q9 */

page_view AS (
SELECT page_name, event_name, COUNT(*) AS count_page_view
FROM consolidate_all
WHERE NOT page_name = 'All products' AND NOT page_name = 'Hoem Page' AND event_name = 'Page View'
GROUP BY page_name, event_name
),      /* query of Q8 */

cart AS (
SELECT page_name, event_name, COUNT(*) AS count_cart
FROM consolidate_all
WHERE NOT page_name = 'All products' AND NOT page_name = 'Hoem Page' AND event_name = 'Add to Cart'
GROUP BY page_name, event_name
),      /* query of Q8 */

abandon AS (
SELECT cart.page_name, cart.count_cart - purchase.num_purchase AS num_abandon
FROM cart, purchase
WHERE cart.page_name = purchase.page_name
)      /* Using add_to_cart number minus number of confirmation of purchase in order to get the abandon number */

SELECT page_view.page_name, count_page_view, count_cart, num_abandon, num_purchase
FROM page_view JOIN cart ON
page_view.page_name = cart.page_name
JOIN abandon ON
page_view.page_name = abandon.page_name
JOIN purchase ON
page_view.page_name = purchase.page_name
ORDER BY page_view.page_name
      /* join all the tables together */
```

|  page_name  | count_page_view | count_cart  | num_abandon | num_purchase|
|----------------|------|-----|-----|------|
| Abalone        | 1525 | 932 | 233 | 699  |
| Black Truffle  | 1469 | 924 | 217 | 707  |
| Crab           | 1564 | 949 | 230 | 719  |
| Kingfish       | 1559 | 920 | 213 | 707  |
| Lobster        | 1547 | 968 | 214 | 754  |
| Oyster         | 1568 | 943 | 217 | 726  |
| Russian Caviar | 1563 | 946 | 249 | 697  |
| Salmon         | 1559 | 938 | 227 | 711  |
| Tuna           | 1515 | 931 | 234 | 697  |


<br>
I created a table call "product_funnel" to store all the result from question above


<br>
<br>

* Additionally, create another table which further aggregates the data for the above points but this time for each product category instead of individual products.

I combined the "product_funnel" table that I created and the "page_hierarchy" table in order to get the product category

```sql
SELECT product_category,SUM(count_page_view),SUM(count_cart),SUM(num_abandon), SUM(num_purchase)
FROM (
SELECT page_hierarchy.product_category, product_funnel.*
FROM product_funnel
JOIN page_hierarchy ON
product_funnel.page_name = page_hierarchy.page_name
) temp
GROUP BY product_category
```

| product_category | SUM(count_page_view)|    SUM(count_pagecount_cart_view)  |  SUM(num_abandon)   |    SUM(num_purchase)   |
|-----------|------|------|-----|-------|
| Fish      | 4633 | 2789 | 674 | 2115  |
| Luxury    | 3032 | 1870 | 466 | 1404  |
| Shellfish | 6204 | 3792 | 894 | 2898  |

* Use your 2 new output tables - answer the following questions:
<br>
  1. Which product had the most views, cart adds and purchases?
  <br>
  most page view: Oyster - 1568 <br>
  most cart adds: Lobster - 968 <br>
  most purchases: Lobster - 754 <br>

  2. Which product was most likely to be abandoned? <br>
  Russian Caviar - 249 (num_abandon)

  3. Which product had the highest view to purchase percentage?

```sql
SELECT *, ROUND (num_purchase/count_page_view,2) AS percentage_view_purchases
SELECT page_name, ROUND (num_purchase/count_page_view,2) AS percentage_view_purchases
FROM product_funnel
ORDER BY num_purchase/count_page_view desc
LIMIT 1	
```

| page_name      | percentage_view_purchases |
|-----------|------|
| Lobster | 0.49 |

  4. What is the average conversion rate from view to cart add?

```sql
SELECT ROUND(AVG(count_cart/count_page_view)*100,2) AS avg_cart_view
FROM casestudy6.product_funnel;
```

|avg_cart_view|
|----------|
| 60.95 |

  5. What is the average conversion rate from cart add to purchase?

```sql
SELECT ROUND(AVG(num_purchase/count_cart)*100,2) AS avg_purchase_cart
FROM casestudy6.product_funnel;
```

|avg_purchase_cart|
|----------|
| 75.93 |

## Campaigns Analysis

Generate a table that has 1 single row for every unique visit_id record and has the following columns:

* user_id
* visit_id
* visit_start_time: the earliest event_time for each visit
* page_views: count of page views for each visit
* cart_adds: count of product cart add events for each visit
* purchase: 1/0 flag if a purchase event exists for each visit
* campaign_name: map the visit to a campaign if the visit_start_time falls between the start_date and end_date
* impression: count of ad impressions for each visit
* click: count of ad clicks for each visit
* (Optional column) cart_products: a comma separated text value with products added to the cart sorted by the order they were added to the cart (hint: use the sequence_number)


```sql
	WITH temp1 AS (
	SELECT events.*, users.user_id, event_identifier.event_name, COUNT(page_id) OVER(PARTITION BY visit_id) AS page_views, 
	MIN(event_time) OVER(PARTITION BY visit_id) AS earlist_visit, /* select the earist time of visit */
	SUM(CASE WHEN events.event_type = 2 then 1 else 0 end) OVER(PARTITION BY visit_id) AS cart_adds, /* count how many time the event - add_to_cart appear for each visit_id */
	SUM(CASE WHEN events.event_type = 4 then 1 else 0 end) OVER(PARTITION BY visit_id) AS impression,
	SUM(CASE WHEN events.event_type = 5 then 1 else 0 end) OVER(PARTITION BY visit_id) AS click,
	SUM(CASE WHEN events.event_type = 3 then 1 else 0 end) OVER(PARTITION BY visit_id) AS purchase

	FROM events
	JOIN users ON
	events.cookie_id = users.cookie_id
	JOIN event_identifier
	ON events.event_type = event_identifier.event_type
	),

	temp2 AS (
	WITH temp AS (
	SELECT events.*, event_identifier.event_name, page_hierarchy.page_name,
	ROW_NUMBER() OVER (PARTITION BY visit_id ORDER BY event_time) AS num  
	FROM events 
	JOIN event_identifier ON 
	events.event_type = event_identifier.event_type
	JOIN page_hierarchy ON
	events.page_id = page_hierarchy.page_id
	WHERE events.event_type = 2
	) /* Query from Q9, filter the visit of add_to_cart and the product added. */
	SELECT visit_id, GROUP_CONCAT(page_name ORDER BY event_time SEPARATOR ',') AS cart_products
	FROM temp
	GROUP BY visit_id
	),
temp3 AS (
	SELECT temp1.visit_id, temp1.user_id, temp1.earlist_visit, temp1.page_views, temp1.cart_adds, temp1.purchase, temp1.impression, temp1.click, temp2.cart_products
	FROM temp1 
	JOIN temp2 ON
	temp1.visit_id = temp2.visit_id
	WHERE event_time = earlist_visit 
    ) /* select only the columns needed */
SELECT temp3.*, campaign_identifier.campaign_name
FROM temp3
JOIN campaign_identifier ON 
temp3.earlist_visit >= campaign_identifier.start_date AND
temp3.earlist_visit <= campaign_identifier.end_date
/* join table with the period of campaign, and filter only the period the earlist_visit in */
```
|  visit_id |user_id|    earlist_visit    | page_views|cart_adds| purchase| impression |click | cart_products |     campaign_name  |
|--------|-----|---------------------|----|---|---|---|---|--------------------------------------------------------------------------|------------------------------------|
| 001597 | 155 | 2020-02-17 00:21:45 | 19 | 6 | 1 | 1 | 1 | Salmon,Russian Caviar,Black Truffle,Lobster,Crab,Oyster                  | Half Off - Treat Your Shellf(ish)  |
| 0048b2 | 78  | 2020-02-10 02:59:51 | 10 | 4 | 0 | 0 | 0 | Kingfish,Russian Caviar,Abalone,Lobster                                  | Half Off - Treat Your Shellf(ish)  |
| 004aaf | 228 | 2020-03-18 13:23:08 | 9  | 2 | 1 | 0 | 0 | Tuna,Lobster                                                             | Half Off - Treat Your Shellf(ish)  |
| 006a61 | 420 | 2020-01-25 20:54:15 | 17 | 5 | 1 | 1 | 1 | Tuna,Russian Caviar,Black Truffle,Abalone,Crab                           | 25% Off - Living The Lux Life      |
| 006f7f | 20  | 2020-02-23 01:36:35 | 9  | 1 | 1 | 1 | 1 | Tuna                                                                     | Half Off - Treat Your Shellf(ish)  |
| 007330 | 436 | 2020-01-07 22:30:36 | 22 | 8 | 1 | 1 | 1 | Salmon,Kingfish,Tuna,Russian Caviar,Black Truffle,Abalone,Lobster,Oyster | BOGOF - Fishing For Compliments    |

<br>
<br>

Use the subsequent dataset to generate at least 5 insights for the Clique Bait team - bonus: prepare a single A4 infographic that the team can use for their management reporting sessions, be sure to emphasise the most important points from your findings.

1. We can see that during the campaign "Half Off - Treat Your Shellf(ish)" has the most impresison and click, means that the campaign is more attracted compared to the others.
And at the same time, this camaign converted to more purchase.

```sql
SELECT campaign_name, SUM(purchase), SUM(impression), SUM(click)
FROM campaigns_analysis
GROUP BY campaign_name

```

| campaign_name                   | SUM(purchase) | SUM(impression) | SUM(click)  |
|-----------------------------------|---------------|-----------------|-------------|
| 25% Off - Living The Lux Life     | 203           | 104             | 81          |
| BOGOF - Fishing For Compliments   | 128           | 66              | 55          |
| Half Off - Treat Your Shellf(ish) | 1188          | 570             | 464         |


2. People who received impression has a hirger chance to finish the purchase, and add more product to their cart compared to the people who did not receive the impression

```sql
WITH having_impression AS (
SELECT impression, SUM(cart_adds), SUM(purchase), SUM(purchase)/SUM(impression)*100 AS purchase_rate
FROM campaigns_analysis
WHERE impression = 1
),
no_impression AS (
SELECT impression, SUM(cart_adds), SUM(purchase), SUM(purchase)/COUNT(impression)*100 AS purchase_rate
FROM campaigns_analysis
WHERE impression = 0
)

SELECT *
FROM having_impression
FULL JOIN no_impression
```

| impression | SUM(cart_adds) | SUM(purchase) | purchase_rate | impression | SUM(cart_adds) | SUM(purchase) | purchase_rate  |
|--------------|----------------|---------------|---------------|------------|----------------|---------------|----------------|
| 1            | 3779           | 637           | 86.0811       | 0          | 3468           | 882           | 62.2881        |


3. On Sunday, people are more liking to browse the website, and more tend to click on the impression and purchase stuff.

```sql
SELECT WEEKDAY(earlist_visit) AS weekday, SUM(purchase) AS total_purchase, SUM(click) AS total_click, COUNT(*) AS total_browse, SUM(click)/COUNT(impression)*100 AS percentage_impression_click
FROM campaigns_analysis
GROUP BY WEEKDAY(earlist_visit)
```

| # weekday | total_purchase | total_click | total_browse | percentage_impression_click  |
|-----------|----------------|-------------|--------------|------------------------------|
| 0         | 252            | 109         | 351          | 31.0541                      |
| 4         | 240            | 90          | 319          | 28.2132                      |
| 6         | 239            | 81          | 334          | 24.2515                      |
| 5         | 215            | 88          | 311          | 28.2958                      |
| 3         | 199            | 70          | 284          | 24.6479                      |
| 2         | 195            | 93          | 295          | 31.5254                      |
| 1         | 179            | 69          | 262          | 26.3359                      |

4. People are tend to purchase, and click on advertisement at night, while browse more page in the afternoon. 

```sql
SELECT period, 
SUM(purchase) AS total_purchase, SUM(click) AS total_click, COUNT(*) AS total_brower, SUM(click)/COUNT(impression)*100 AS percentage_impression_click
FROM (
SELECT *,
CASE WHEN 
HOUR(earlist_visit) >=0 AND HOUR(earlist_visit) < 6
THEN 'Midnight'
WHEN 
(earlist_visit) >=6 AND HOUR(earlist_visit) < 12
THEN 'Morning'
WHEN
(earlist_visit) >= 12 AND HOUR(earlist_visit) < 18
THEN 'Afternoon'
ELSE 'Night'
END AS period
FROM campaigns_analysis
) period
GROUP BY period
```

| # period  | total_purchase | total_click | total_brower | percentage_impression_click  |
|-----------|----------------|-------------|--------------|------------------------------|
| Afternoon | 388            | 133         | 567          | 23.4568                      |
| Night     | 393            | 175         | 553          | 31.6456                      |
| Morning   | 373            | 162         | 534          | 30.3371                      |
| Midnight  | 365            | 130         | 502          | 25.8964                      |

5. People who clicked on the ad tend to buy more items

```sql
WITH temp1 AS (
SELECT SUM(item_count)/SUM(user_id)* 100 AS purchase_amount_per_user_click_ad
FROM (
SELECT * ,
LENGTH(cart_products) - LENGTH(REPLACE(cart_products, ',', '')) + 1 AS item_count /* count how many item have in the cart */ 
FROM casestudy6.campaigns_analysis
) AS item
WHERE click = 1 
),
/* purchase amount per user for people that clicked on the ad. */ 
temp2 AS (
SELECT SUM(item_count)/SUM(user_id)* 100 AS purchase_amount_per_user_no_ad
FROM (
SELECT * ,
LENGTH(cart_products) - LENGTH(REPLACE(cart_products, ',', '')) + 1 AS item_count
FROM casestudy6.campaigns_analysis
) AS item
WHERE click = 0
) 
/* purchase amount per user for people that did not click on the ad. */ 
SELECT *
FROM temp1
FULL JOIN temp2
```

| # purchase_amount_per_user_click_ad | purchase_amount_per_user_no_ad  | 
|-------------------------------------|---------------------------------|
| 2.4171                              | 1.0106                          |  

6. All the campagin has a positive effect of increasinng the item purchased, and the amount of increased item are similar.

```sql
SELECT *, purchase_amount_per_user_click_ad - purchase_amount_per_user_no_ad AS different_purchase
FROM(
WITH temp1 AS (
SELECT campaign_name, SUM(item_count)/SUM(user_id)* 100 AS purchase_amount_per_user_click_ad
FROM (
SELECT * ,
LENGTH(cart_products) - LENGTH(REPLACE(cart_products, ',', '')) + 1 AS item_count 
FROM casestudy6.campaigns_analysis
WHERE click = 1
) AS item
GROUP BY campaign_name
),
/* quary from observation 5. */
temp2 AS (
SELECT campaign_name, SUM(item_count)/SUM(user_id)* 100 AS purchase_amount_per_user_no_ad
FROM (
SELECT * ,
LENGTH(cart_products) - LENGTH(REPLACE(cart_products, ',', '')) + 1 AS item_count
FROM casestudy6.campaigns_analysis
WHERE click = 0
) AS item
GROUP BY campaign_name
) 
/* quary from observation 5. */
SELECT temp1.campaign_name, purchase_amount_per_user_click_ad, purchase_amount_per_user_no_ad
FROM temp1
JOIN temp2 ON
temp1.campaign_name = temp2.campaign_name
) temp3
```

| # campaign_name                   | purchase_amount_per_user_click_ad | purchase_amount_per_user_no_ad | different_purchase  |   |
|-----------------------------------|-----------------------------------|--------------------------------|---------------------|---|
| BOGOF - Fishing For Compliments   | 2.4522                            | 0.9737                         | 1.4785              |   |
| Half Off - Treat Your Shellf(ish) | 2.4265                            | 1.0111                         | 1.4154              |   |
| 25% Off - Living The Lux Life     | 2.3440                            | 1.0312                         | 1.3128              |   |